# 도구 API (Tools API)

OpenManus의 도구(Tool) 시스템에 대한 API 참조입니다.

## BaseTool

모든 도구의 기본 클래스입니다.

### 클래스 정의

```python
class BaseTool(BaseModel, ABC):
    """도구 기본 클래스"""
    
    name: str  # 도구 이름
    description: str  # 도구 설명
    parameters: Optional[dict]  # 매개변수 스키마
```

### 필수 메서드

#### `async execute(**kwargs) -> ToolResult`

도구를 실행합니다. (추상 메서드)

**매개변수:**
- `**kwargs`: 도구별 매개변수

**반환값:**
- ToolResult: 실행 결과

## ToolResult

도구 실행 결과를 나타냅니다.

### 클래스 정의

```python
class ToolResult(BaseModel):
    """도구 실행 결과"""
    
    output: str  # 출력 내용
    is_error: bool = False  # 오류 여부
    metadata: Optional[dict] = None  # 추가 메타데이터
```

## 내장 도구

### PythonExecute

Python 코드를 실행합니다.

#### 매개변수

```python
{
    "code": str  # 실행할 Python 코드
}
```

#### 예제

```python
from app.tool.code import PythonExecute

tool = PythonExecute(sandbox_manager=sandbox)

result = await tool.execute(code="""
import pandas as pd
df = pd.DataFrame({'A': [1, 2, 3]})
print(df.describe())
""")

print(result.output)
```

### BrowserUseTool

웹 브라우저를 제어합니다.

#### 매개변수

```python
{
    "action": str,  # "navigate", "click", "fill", etc.
    "url": Optional[str],  # 이동할 URL
    "selector": Optional[str],  # CSS 선택자
    "value": Optional[str]  # 입력값
}
```

#### 예제

```python
from app.tool.browser import BrowserUseTool

tool = BrowserUseTool()

# 페이지 이동
result = await tool.execute(
    action="navigate",
    url="https://example.com"
)

# 요소 클릭
result = await tool.execute(
    action="click",
    selector="#submit-button"
)
```

### StrReplaceEditor

파일을 편집합니다.

#### 매개변수

```python
{
    "path": str,  # 파일 경로
    "old_str": str,  # 찾을 문자열
    "new_str": str  # 교체할 문자열
}
```

#### 예제

```python
from app.tool.editor import StrReplaceEditor

tool = StrReplaceEditor()

result = await tool.execute(
    path="config.py",
    old_str="DEBUG = False",
    new_str="DEBUG = True"
)
```

### WebSearch

웹을 검색합니다.

#### 매개변수

```python
{
    "query": str,  # 검색 쿼리
    "num_results": int = 5  # 결과 개수
}
```

#### 예제

```python
from app.tool.web import WebSearch

tool = WebSearch()

result = await tool.execute(
    query="OpenAI GPT-4",
    num_results=10
)
```

## ToolCollection

도구 모음을 관리합니다.

### 클래스 정의

```python
class ToolCollection:
    """도구 컬렉션"""
    
    def __init__(self):
        self.tools: Dict[str, BaseTool] = {}
```

### 주요 메서드

#### `add_tool(tool: BaseTool) -> None`

도구를 추가합니다.

**예제:**

```python
collection = ToolCollection()
collection.add_tool(PythonExecute(sandbox_manager=sandbox))
collection.add_tool(BrowserUseTool())
```

#### `get_tool(name: str) -> Optional[BaseTool]`

도구를 조회합니다.

**예제:**

```python
tool = collection.get_tool("python_execute")
if tool:
    result = await tool.execute(code="print('Hello')")
```

#### `list_tools() -> List[str]`

모든 도구 이름을 반환합니다.

**예제:**

```python
tools = collection.list_tools()
print(f"사용 가능한 도구: {', '.join(tools)}")
```

#### `get_schemas() -> List[dict]`

모든 도구의 스키마를 반환합니다.

**반환값:**
- List[dict]: OpenAI function calling 형식의 스키마

**예제:**

```python
schemas = collection.get_schemas()
# LLM에 전달하여 도구 사용 가능하게 함
```

## 커스텀 도구 만들기

### 기본 구조

```python
from app.tool.base import BaseTool, ToolResult

class MyCustomTool(BaseTool):
    """커스텀 도구"""
    
    name: str = "my_tool"
    description: str = "내 커스텀 기능"
    parameters: dict = {
        "type": "object",
        "properties": {
            "input": {
                "type": "string",
                "description": "입력값"
            }
        },
        "required": ["input"]
    }
    
    async def execute(self, **kwargs) -> ToolResult:
        input_val = kwargs.get("input")
        
        try:
            # 도구 로직
            result = self._process(input_val)
            
            return ToolResult(
                output=result,
                is_error=False
            )
        except Exception as e:
            return ToolResult(
                output=str(e),
                is_error=True
            )
    
    def _process(self, input_val: str) -> str:
        # 실제 처리 로직
        return f"처리됨: {input_val}"
```

### 도구 등록 및 사용

```python
# 도구 생성
my_tool = MyCustomTool()

# 컬렉션에 추가
collection = ToolCollection()
collection.add_tool(my_tool)

# 에이전트에서 사용
agent = ToolCallAgent(tools=collection)
result = await agent.run("my_tool을 사용해서 'test' 처리해줘")
```

## MCP 도구

### MCPTool

MCP 서버의 도구를 래핑합니다.

```python
class MCPTool(BaseTool):
    """MCP 도구 래퍼"""
    
    mcp_client: MCPClient  # MCP 클라이언트
    tool_name: str  # MCP 도구 이름
```

### MCP 도구 사용

```python
from app.mcp import MCPClient

# MCP 클라이언트 생성
client = await MCPClient.create(
    name="filesystem",
    command="npx",
    args=["-y", "@modelcontextprotocol/server-filesystem", "/workspace"]
)

# 도구 목록 조회
tools = await client.list_tools()

# 도구 호출
result = await client.call_tool(
    name="read_file",
    arguments={"path": "/workspace/data.txt"}
)
```

## 도구 메타데이터

### 스키마 형식

도구 스키마는 JSON Schema를 따릅니다:

```python
{
    "type": "object",
    "properties": {
        "param1": {
            "type": "string",
            "description": "첫 번째 매개변수"
        },
        "param2": {
            "type": "number",
            "description": "두 번째 매개변수",
            "default": 0
        }
    },
    "required": ["param1"]
}
```

### 지원되는 타입

- `string`: 문자열
- `number`: 숫자
- `integer`: 정수
- `boolean`: 불리언
- `array`: 배열
- `object`: 객체

## 오류 처리

### ToolResult를 통한 오류 처리

```python
try:
    result = await tool.execute(**params)
    
    if result.is_error:
        print(f"도구 실행 실패: {result.output}")
    else:
        print(f"성공: {result.output}")
        
except Exception as e:
    print(f"예외 발생: {e}")
```

### 커스텀 예외

```python
class ToolError(Exception):
    """도구 실행 오류"""
    pass

class MyTool(BaseTool):
    async def execute(self, **kwargs) -> ToolResult:
        try:
            # 검증
            if not self._validate(kwargs):
                raise ToolError("잘못된 매개변수")
            
            # 실행
            result = self._do_work(kwargs)
            
            return ToolResult(output=result)
            
        except ToolError as e:
            return ToolResult(output=str(e), is_error=True)
```

## 참고

- [도구 개념](../concepts/tools.mdx)
- [에이전트 API](./agents.mdx)
- [커스텀 도구 개발 가이드](../guides/developing-tools.mdx)
