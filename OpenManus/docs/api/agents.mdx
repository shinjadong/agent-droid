# 에이전트 API (Agents API)

OpenManus의 핵심 에이전트 클래스들에 대한 API 참조입니다.

## BaseAgent

모든 에이전트의 기본 클래스입니다.

### 클래스 정의

```python
class BaseAgent(BaseModel, ABC):
    """에이전트 기본 클래스"""
    
    name: str  # 에이전트 이름
    llm: LLMClient  # LLM 클라이언트
    memory: Memory  # 대화 메모리
    state: AgentState  # 에이전트 상태
```

### 주요 메서드

#### `async run(request: str) -> str`

에이전트를 실행합니다.

**매개변수:**
- `request` (str): 사용자 요청

**반환값:**
- str: 실행 결과

**예제:**

```python
agent = await Manus.create()
result = await agent.run("Python으로 파일을 읽어줘")
```

#### `async step() -> str`

단일 실행 단계를 수행합니다. (추상 메서드)

**반환값:**
- str: 단계 실행 결과

#### `async cleanup() -> None`

에이전트 리소스를 정리합니다.

**예제:**

```python
try:
    await agent.run("작업 수행")
finally:
    await agent.cleanup()
```

## ToolCallAgent

도구 호출 기능이 있는 에이전트입니다.

### 클래스 정의

```python
class ToolCallAgent(BaseAgent):
    """도구를 사용할 수 있는 에이전트"""
    
    tools: ToolCollection  # 사용 가능한 도구들
    max_iterations: int = 20  # 최대 반복 횟수
```

### 주요 메서드

#### `async call_tool(tool_name: str, **kwargs) -> ToolResult`

특정 도구를 직접 호출합니다.

**매개변수:**
- `tool_name` (str): 도구 이름
- `**kwargs`: 도구 인자

**반환값:**
- ToolResult: 도구 실행 결과

**예제:**

```python
result = await agent.call_tool(
    "python_execute",
    code="print('Hello')"
)
```

## Manus

범용 에이전트입니다.

### 클래스 생성

#### `@classmethod async create(**kwargs) -> Manus`

Manus 에이전트를 생성합니다.

**매개변수:**
- `llm_settings` (Optional[LLMSettings]): LLM 설정
- `sandbox_settings` (Optional[SandboxSettings]): 샌드박스 설정
- `browser_settings` (Optional[BrowserSettings]): 브라우저 설정

**반환값:**
- Manus: 생성된 에이전트 인스턴스

**예제:**

```python
# 기본 설정
agent = await Manus.create()

# 커스텀 설정
from app.config import LLMSettings

agent = await Manus.create(
    llm_settings=LLMSettings(
        model="gpt-4",
        temperature=0.7
    )
)
```

### 사용 가능한 도구

Manus는 다음 도구들을 기본으로 제공합니다:

- **PythonExecute**: Python 코드 실행
- **BrowserUseTool**: 웹 브라우저 자동화
- **StrReplaceEditor**: 파일 편집
- **WebSearch**: 웹 검색
- **AskHuman**: 사용자 입력 요청
- **Terminate**: 작업 종료

## DataAnalysis

데이터 분석 전문 에이전트입니다.

### 클래스 생성

#### `@classmethod async create(**kwargs) -> DataAnalysis`

DataAnalysis 에이전트를 생성합니다.

**예제:**

```python
analyst = await DataAnalysis.create()

result = await analyst.run("""
sales_data.csv를 분석해서
월별 매출 추이를 차트로 만들어줘
""")
```

## MCPAgent

MCP 도구를 사용하는 에이전트입니다.

### 클래스 생성

#### `@classmethod async create(**kwargs) -> MCPAgent`

MCP 에이전트를 생성합니다.

**예제:**

```python
mcp_agent = await MCPAgent.create()

result = await mcp_agent.run("""
파일 시스템 MCP 도구를 사용해서
workspace의 모든 파일 목록을 가져와줘
""")
```

### MCP 특화 메서드

#### `async list_mcp_tools() -> List[str]`

사용 가능한 MCP 도구 목록을 반환합니다.

**반환값:**
- List[str]: 도구 이름 목록

**예제:**

```python
tools = await mcp_agent.list_mcp_tools()
for tool in tools:
    print(f"- {tool}")
```

## 상태 관리

### AgentState

에이전트의 현재 상태를 나타냅니다.

```python
class AgentState(str, Enum):
    IDLE = "idle"  # 대기 중
    RUNNING = "running"  # 실행 중
    FINISHED = "finished"  # 완료
    ERROR = "error"  # 오류
```

### 상태 확인

```python
# 현재 상태 확인
if agent.state == AgentState.RUNNING:
    print("에이전트 실행 중...")

# 상태 변경 이벤트
agent.on_state_change = lambda old, new: print(f"{old} -> {new}")
```

## 메모리 관리

### 메모리 접근

```python
# 메시지 추가
agent.memory.add_message(
    Message(role="user", content="안녕하세요")
)

# 메시지 조회
messages = agent.memory.get_messages()

# 메모리 초기화
agent.memory.clear()
```

### 메모리 설정

```python
# 최대 메시지 수 설정
agent.memory.max_messages = 50

# 메모리 크기 확인
size = len(agent.memory.messages)
```

## 오류 처리

### 예외 타입

```python
from app.agent.base import (
    AgentError,  # 일반 에이전트 오류
    ToolExecutionError,  # 도구 실행 오류
    MaxIterationsError,  # 최대 반복 초과
)
```

### 오류 처리 예제

```python
try:
    result = await agent.run("작업 수행")
except ToolExecutionError as e:
    print(f"도구 실행 실패: {e}")
except MaxIterationsError:
    print("최대 반복 횟수 초과")
except AgentError as e:
    print(f"에이전트 오류: {e}")
```

## 참고

- [에이전트 개념](../concepts/agents.mdx)
- [커스텀 에이전트 만들기](../guides/building-custom-agent.mdx)
- [도구 API](./tools.mdx)
